import Image from '@site/src/components/Image';

# 4.1 네트워크 계층 계요

<Image src="https://user-images.githubusercontent.com/63354527/235395650-4afd32e6-04aa-41bf-ba85-43be79454782.png" />

두 호스트 H1과 H2가 있을 때, 네트워크 계층은 두 호스트 중 하나의 트랜스포트 계층 세그먼트를 추출하여
H2의 트랜스포트 계층까지 전달하는 역할을 한다.

라우터는 트랜스포트 계층과 애플리케이션 계층을 지원하지 않으므로 프로토콜 스택에서 네트워크 계층의
상위 계층은 존재하지 않는다.

각 라우터에는 데이터 평면과 제어 평면이 존재한다.

- `데이터 평면`: 입력 링크에서 출력 링크로 데이터그램을 전달한다.
- `제어 평면`: 데이터그램이 출발지 호스트에서 목적지 호스트까지 전달되게끔 로컬 포워딩, 라우터별 포워딩을 대응

## 4.1.1 포워딩과 라우팅: 데이터 평면과 제어 평면

> 네트워크 계층의 근본적인 역할은 송신 호스트에서 수신 호스트로 패킷을 전달하는 것이다.

위 역할을 위한 중요한 기능 두 가지

- `포워딩(전달)`: 패킷이 라우터의 입력 링크에 도달했을 때 라우터는 그 패킷을 적절한 출력 링크로 이동시켜야 한다.
  포워딩에서 예외적으로 한 기능은 데이터 평면에서 실행된다. 매우 짧은 시간 단위(보통 몇 나노초)를 갖기에
  대표적으로 하드웨어에서 실행된다.
- `라우팅`: 송신자가 수신자에게 패킷을 보낼 때 네트워크 계층은 패킷 경로를 결정해야 한다. 이러한 경로를 계산하는
  알고리즘을 라우팅 알고리즘이라고 한다. 네트워크 전반에 걸쳐 출발지에서 목적지까지 데이터그램의 종단 간 경로를
  결정하여 시간이 오래걸려 소프트웨어에서 실행된다.

### 포워딩 테이블

<Image src="https://user-images.githubusercontent.com/63354527/235398438-cd64dfd7-a1d2-43cb-a3fc-7797d9de744b.png" />

라우터는 도착하는 **패킷 헤더의 필드값을 통해 포워딩 테이블의 내부 색인으로 사용하여 패킷을 전달**한다.  
포워딩 테이블 엔트리에 저장되어 있는 헤더의 값은 해당 패킷이 전달되어야 할 라우터의 외부 링크 인터페이스를 나타낸다.

### 제어 평면: 전통적인 접근 방법

라우팅 알고리즘은 각각의 모든 라우터에서 실행되며, 라우터는 포워딩과 라우팅 기능을 모두 갖고 있어야 한다.
또한, 한 라우터의 라우팅 알고리즘 기능은 다른 라우터의 라우팅 알고리즘과 소통하며 포워딩 테이블의 값을 계산한다.  
이러한 소통은 라우팅 프로토콜에 따라 라우팅 정보에 포함한 라우팅 메시지를 교환하며 이루어진다.

### 제어 평면: SDN 접근 방법

<Image src="https://user-images.githubusercontent.com/63354527/235399864-f4ce9c53-e712-4a4e-b0dd-b82eaba1c1cf.png" />

위 그림은 라우터로부터 물리적으로 분리된 원격 컨트롤러 컴퓨터와 각각의 라우터에 의해 사용될 포워딩
테이블을 분배하는 다른 접근법을 보여준다.

라우터는 원격 컨트롤러와 포워딩 테이블과 그 밖의 라우팅 정보를 포함한 메시지를 교환함으로써 소통한다.

원격 컨트롤러가 포워딩 테이블을 계산 및 배분하는 동안 라우팅 기기는 포워딩만을 수행한다.
즉, 네트워크가 소프트웨어적으로 정의되었을 때 포워딩 테이블을 계산하는 컨트롤러는 라우터와 상호작용을 하며
소프트웨어에서 실행된다.

이렇게 원격 컨트롤러가 라우터와 떨어져서 높은 신뢰성과 중복성을 갖춘 원격 데이터 센터에 위치하는 접근 방법은
SDN(Software-Defined Networking)의 중심이다.

## 4.1.2 네트워크 서비스 모델

네트워크 계층 제공 서비스

- `보장된 전달`: 이 서비스 패킷이 출발지 호스트에서부터 목적지 호스트까지 도착하는 것을 보장한다.
- `지연 제한 이내의 보장된 전달`: 이 서비스는 패킷의 전달을 보장할 뿐만 아니라 호스트 간의 특정 지연 제한(예: 100ms이내) 안에 전달한다.
- `순서화 패킷 전달`: 이 서비스는 패킷이 목적지에 송신된 순서대로 도착하는 것을 보장한다.
- `최소 대역폭 보장`: 이 네트워크 계층 서비스는 송신과 수신 호스트 사이에 특정한 비트율의 전송 링크를 애뮬레이트한다.
  송신 호스트가 비트들을 특정한 비트율 이하로 전송하는 한, 모든 패킷이 목적지 호스트까지 전달된다.
- `보안 서비스`: 네트워크 계층은 모든 데이터 그램을 출발지 호스트에서는 암호화, 목적지 호스트에서는 복호화 할 수 있게 하여
  트랜스포트 계층의 모든 세그먼트에 대해 기밀성을 유지해야한다.

이 외에도 수많은 변형들이 있다.

인터넷 네트워크 계층은 최선형 서비스(`best-effort service`) 라고 알려진 서비스를 제공한다.

최선형 서비스의 특징

- 패킷을 보내는 순서대로 수신됨을 보장하지 않는다.
- 목적지까지 패킷이 전송됨을 보장하지 않는다.
- 종단 시스템 간 지연이 보장되지 않는다.
- 보장된 최소 대역폭이 없다.
- 이렇게 서비스를 제공하지 못하는 인터넷 네트워크 계층의 대안으로 좋은 보다 서비스 모델을 정의하고 구현했지만 인터넷 네트워크 계층은 놀라운 범위의 애플리케이션을 가능하게 할만큼 충분히 좋다고 입증되었다.
